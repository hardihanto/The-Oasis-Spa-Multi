<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">
    <div id="loginSection" class="max-w-md mx-auto bg-white p-8 rounded-lg shadow-md mt-20">
        <h2 class="text-2xl font-bold mb-5">Login Admin</h2>
        <input type="text" id="bizId" placeholder="ID Bisnis (oasis-spa)" class="w-full border p-2 mb-3 rounded">
        <input type="password" id="bizPass" placeholder="Password" class="w-full border p-2 mb-5 rounded">
        <button onclick="login()" class="w-full bg-blue-600 text-white py-2 rounded">Masuk</button>
    </div>

    <div id="adminSection" class="hidden max-w-4xl mx-auto">
        <h1 id="shopName" class="text-3xl font-bold mb-5">Dashboard</h1>
        <div class="bg-white rounded shadow">
            <table class="w-full text-left">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="p-4">Nama</th>
                        <th class="p-4">WA</th>
                        <th class="p-4">Jadwal</th>
                    </tr>
                </thead>
                <tbody id="dataTamu"></tbody>
            </table>
        </div>
    </div>

    <script>
        const SB_URL = "https://oivvcaeqfyssnphvtojg.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pdnZjYWVxZnlzc25waHZ0b2pnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0NTk3NDAsImV4cCI6MjA4NzAzNTc0MH0.cG0WG5_TWu7ivdNVkz4BlGyugHwHIKRlQS50e9iXKwo";
        const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

        async function login() {
            const id = document.getElementById('bizId').value;
            const pass = document.getElementById('bizPass').value;

            const { data, error } = await supabaseClient
                .from('businesses')
                .select('*')
                .eq('id', id)
                .eq('admin_password', pass)
                .maybeSingle();

            if (data) {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('adminSection').classList.remove('hidden');
                document.getElementById('shopName').innerText = data.business_name;
                loadBookings(data.id);
            } else {
                alert("Login Gagal!");
            }
        }

        async function loadBookings(bizId) {
            const { data } = await supabaseClient.from('bookings').select('*').eq('business_id', bizId);
            const container = document.getElementById('dataTamu');
            container.innerHTML = data.map(b => `
                <tr class="border-b">
                    <td class="p-4">${b.client_name}</td>
                    <td class="p-4">${b.client_wa}</td>
                    <td class="p-4">${b.booking_date} ${b.booking_time}</td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
