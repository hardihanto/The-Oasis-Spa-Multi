<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merchant Gateway | SaaSBOOK</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: #f8fafc; }
        .neo-glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .input-field { @apply w-full bg-slate-950/50 border border-slate-800 p-4 pl-12 rounded-2xl outline-none focus:ring-2 focus:ring-emerald-500/40 focus:border-emerald-500 transition-all text-sm; }
        .label-text { @apply text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] mb-2 block ml-1; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6 relative">

    <div class="neo-glass w-full max-w-2xl rounded-[3rem] p-10 md:p-14 shadow-2xl overflow-hidden relative">
        <div class="absolute -top-24 -right-24 w-48 h-48 bg-emerald-500/10 rounded-full blur-3xl"></div>

        <div class="text-center mb-12">
            <h1 class="text-4xl font-extrabold tracking-tighter italic">Mulai Bisnis <span class="text-emerald-400">Digital.</span></h1>
            <p class="text-slate-400 text-sm mt-2">Lengkapi data untuk membuat dashboard SaaSBOOK Anda</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="md:col-span-2">
                <label class="label-text">Nama Bisnis / Brand</label>
                <div class="relative">
                    <i class="fa-solid fa-shop absolute left-4 top-1/2 -translate-y-1/2 text-slate-600"></i>
                    <input type="text" id="bizName" placeholder="Contoh: Assyifa Beauty Spa" class="input-field">
                </div>
            </div>

            <div>
                <label class="label-text">WhatsApp Aktif</label>
                <div class="relative">
                    <i class="fa-brands fa-whatsapp absolute left-4 top-1/2 -translate-y-1/2 text-slate-600"></i>
                    <input type="number" id="bizWA" placeholder="08123456789" class="input-field">
                </div>
            </div>

            <div>
                <label class="label-text">ID Transaksi / Slug</label>
                <div class="relative">
                    <i class="fa-solid fa-fingerprint absolute left-4 top-1/2 -translate-y-1/2 text-slate-600"></i>
                    <input type="text" id="bizID" placeholder="assyifa" class="input-field">
                </div>
            </div>

            <div class="md:col-span-2 flex items-center gap-4 my-2">
                <div class="h-[1px] bg-slate-800 flex-1"></div>
                <span class="text-[9px] text-slate-600 font-bold uppercase tracking-widest">Akses Admin Dashboard</span>
                <div class="h-[1px] bg-slate-800 flex-1"></div>
            </div>

            <div class="md:col-span-2">
                <label class="label-text">Admin Password</label>
                <div class="relative">
                    <i class="fa-solid fa-key absolute left-4 top-1/2 -translate-y-1/2 text-slate-600"></i>
                    <input type="password" id="bizPass" placeholder="••••••••" class="input-field">
                </div>
            </div>
        </div>

        <div class="mt-12">
            <button onclick="deployInstance()" id="btnReg" class="w-full bg-emerald-500 hover:bg-emerald-400 text-slate-950 font-black py-5 rounded-[2rem] transition-all transform hover:scale-[1.01] active:scale-95 flex items-center justify-center gap-3 shadow-xl shadow-emerald-500/10">
                <span>DAFTAR & AKTIVASI SEKARANG</span>
                <i class="fa-solid fa-arrow-right"></i>
            </button>
            <p class="text-[10px] text-slate-600 text-center mt-6 italic">Data dikirim ke server Supabase v2.0 (Production Mode)</p>
        </div>
    </div>

    <script>
        const SB_URL = "https://strylleubkvuirsknqbk.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN0cnlsbGV1Ymt2dWlyc2tucWJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0ODM2OTksImV4cCI6MjA4NzA1OTY5OX0.sfnSvVgUoBRgwDyYY5VBAaHPHM_rPKBQ4a3w1ziKgUw";
        const sb = supabase.createClient(SB_URL, SB_KEY);

        async function deployInstance() {
            const btn = document.getElementById('btnReg');
            
            // Mapping Data sesuai kolom database Anda di screenshot
            const payload = {
                id: document.getElementById('bizID').value.toLowerCase().trim(),
                business_name: document.getElementById('bizName').value,
                admin_password: document.getElementById('bizPass').value,
                owner_wa: document.getElementById('bizWA').value,
                is_active: false
            };

            if (Object.values(payload).some(v => v === "")) {
                return alert("⚠️ Mohon lengkapi semua parameter sistem.");
            }

            btn.innerHTML = '<i class="fa-solid fa-circle-notch animate-spin"></i> INITIALIZING DB...';
            btn.disabled = true;

            try {
                const { error } = await sb.from('businesses').insert([payload]);
                
                if (error) throw error;

                alert("✅ PENDAFTARAN BERHASIL!\nData tersimpan di tabel businesses.");
                window.location.reload();

            } catch (err) {
                alert("DATABASE ERROR: " + err.message);
                btn.innerHTML = '<span>DAFTAR & AKTIVASI SEKARANG</span> <i class="fa-solid fa-arrow-right"></i>';
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
