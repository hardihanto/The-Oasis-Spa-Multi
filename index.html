<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Reservasi Online</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-emerald-50 min-h-screen flex items-center justify-center p-4">

    <div id="mainBox" class="bg-white p-8 rounded-[2.5rem] shadow-2xl w-full max-w-md border hidden">
        <h1 id="namaToko" class="text-2xl font-black text-center text-slate-800 italic mb-6">--</h1>
        <form id="formBooking" class="space-y-4">
            <input type="text" id="nama" placeholder="Nama Lengkap" required class="w-full p-4 rounded-2xl border bg-slate-50">
            <input type="number" id="wa" placeholder="Nomor WhatsApp" required class="w-full p-4 rounded-2xl border bg-slate-50">
            <div class="grid grid-cols-2 gap-4">
                <input type="date" id="tgl" required class="w-full p-4 rounded-2xl border bg-slate-50 text-sm">
                <input type="time" id="jam" required class="w-full p-4 rounded-2xl border bg-slate-50 text-sm">
            </div>
            <button type="submit" id="btn" class="w-full bg-emerald-600 text-white font-bold py-5 rounded-2xl shadow-xl hover:bg-emerald-700 transition">Booking Sekarang</button>
        </form>
    </div>

    <div id="inactiveBox" class="hidden text-center bg-white p-10 rounded-[2.5rem] shadow-xl">
        <h2 class="text-xl font-bold text-slate-800">Layanan Non-Aktif</h2>
        <p class="text-slate-400 mt-2">Toko ini belum mengaktifkan layanan reservasi.</p>
    </div>

    <script>
        const SB_URL = "https://strylleubkvuirsknqbk.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN0cnlsbGV1Ymt2dWlyc2tucWJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0ODM2OTksImV4cCI6MjA4NzA1OTY5OX0.sfnSvVgUoBRgwDyYY5VBAaHPHM_rPKBQ4a3w1ziKgUw";
        const sb = supabase.createClient(SB_URL, SB_KEY);
        const bizId = new URLSearchParams(window.location.search).get('id');

        async function init() {
            if(!bizId) return;
            const { data } = await sb.from('businesses').select('*').eq('id', bizId).maybeSingle();
            if(data && data.is_active) {
                document.getElementById('namaToko').innerText = data.business_name;
                document.getElementById('mainBox').classList.remove('hidden');
            } else {
                document.getElementById('inactiveBox').classList.remove('hidden');
            }
        }

        document.getElementById('formBooking').onsubmit = async (e) => {
            e.preventDefault();
            const payload = {
                business_id: bizId,
                client_name: document.getElementById('nama').value,
                client_wa: document.getElementById('wa').value,
                booking_date: document.getElementById('tgl').value,
                booking_time: document.getElementById('jam').value
            };
            const { error } = await sb.from('bookings').insert([payload]);
            if(!error) { 
                alert("Berhasil Terkirim!"); 
                location.reload(); 
            }
        };

        init();
    </script>
</body>
</html>
